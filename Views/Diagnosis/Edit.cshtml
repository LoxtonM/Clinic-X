@model ClinicX.ViewModels.TestDiseaseVM

@{
    ViewData["Title"] = "Clinic-X - Diagnosis Details";
}

<div class="mb-5">
    <input type="button" value="Back" id="btnBack" class="btn btn-default btn-success" />
    @*<a type="button" class="btn btn-default btn-success" asp-controller="Test" asp-action="Index" asp-route-id=@Html.ValueFor(Model => Model.MPI)>Back to Test List</a>*@
</div>


<h1>Diagnosis details for @Html.ValueFor(Model => Model.patient.FIRSTNAME) @Html.ValueFor(Model => Model.patient.LASTNAME) </h1>
<div>
    <dl class="row mb-5">
        <dt class="col-sm-2">
            Diagnosis:
        </dt>
        <dd class="col-sm-10">
            @Html.DisplayFor(model => model.Diagnosis.DISEASE_CODE) - @Html.DisplayFor(model => model.Diagnosis.DESCRIPTION)
        </dd>
        <dt class="col-sm-2">
            Entered by:
        </dt>
        <dd class="col-sm-10">
            @Html.DisplayFor(model => model.Diagnosis.NAME) on @Html.DisplayFor(model => model.Diagnosis.ENTEREDDATE)
        </dd>
    </dl>
</div>

<div class="container mb-5">
    <form id="DiagForm" asp-action="Edit">
        <div id="metadata" hidden="true">
            <input asp-for=@Model.Diagnosis.ID type="text" id="txtDiagID" name="iDiagID" />
        </div>
        <div class="row mb-5">            
            <div class="col-md-2">Disease status:</div>
            <div class="col-md-2">
                <select asp-for=@Model.Diagnosis.STATUS id="ddlStatus" name="sStatus">
                    <option value="" selected>select...</option>
                    @foreach (var d in Model.statusList)
                    {
                        <option value="@d.DISEASE_STATUS">@d.DISEASE_STATUS</option>
                    }
                </select>
            </div>
            <div class="col-md-2">Comments:</div>
            <div class="col-md-6"><input asp-for=@Model.Diagnosis.MAIN_SUB type="text" id="txtComments" name="sComments" /></div>
        </div>
        <div class="row mb-5">
            <div class="col-md-2"></div>
            <div class="col-md-8">
                <input type="button" class="btn btn-default btn-success" value="Save" id="btnSaveDiag" />
            </div>
            <div class="col-md-2"></div>
        </div>
    </form>
</div>

<script>

    window.addEventListener("load", LoadDiagData);
    document.getElementById("btnSaveDiag").addEventListener("click", SaveDiag);
    document.getElementById("btnBack").addEventListener("click", GoBack);


    function GoBack() 
    {
        window.history.back();
        //window.close();
    }

    function LoadDiagData() 
    {                        
        document.getElementById("ddlStatus").value = "@(Model.Diagnosis.STATUS)";
        document.getElementById("txtComments").value = "@(Model.Diagnosis.MAIN_SUB)";
        document.getElementById("txtDiagID").value = "@(Model.Diagnosis.ID)";        
    }

    function SaveDiag() 
    {
        if (CheckFormValid() == 1) {
            document.getElementById("DiagForm").submit();
        }
    }

    function CheckFormValid() 
    {        
        //gotta protect against those SQL injections!
        if (document.getElementById("txtComments").value.match(/};.*/)) {
            window.alert("Oi! Stop trying to inject SQL code into my form!");
            return 0;
        }
        return 1;
    }

</script>
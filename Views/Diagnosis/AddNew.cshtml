@model ClinicX.ViewModels.TestDiseaseVM

@{
    ViewData["Title"] = "Clinic-X - Add New Diagnosis";
}

<div class="container">
    <div class ="row g-5 mb-5">
        <div class="col-md-2">
            @*<input type="button" value="Back" id="btnBack" class="btn btn-default btn-success" />*@
            <a type="button" class="btn btn-default btn-success" asp-controller="Diagnosis" asp-action="Index" asp-route-id=@Html.ValueFor(Model => Model.patient.MPI)>Back to Diagnosis List</a>
        </div>
    </div>

    <h1>Add new diagnosis for @Html.DisplayFor(Model => Model.patient.FIRSTNAME) @Html.DisplayFor(Model => Model.patient.LASTNAME)</h1>

    <form id="frmAddNew" asp-action="AddNew">
        <div class="row g-5 mb-5">
            <div class="col-md-2">
                Diagnosis:
            </div>
            <div class="col-md-4">
                <select id="ddlDiag" name="diseaseCode" class="w-100">
                    <option value="" selected>select...</option>
                    @foreach (var d in Model.diseaseList)
                    {
                        <option value="@d.DISEASE_CODE">@d.DISEASE_CODE - @d.DESCRIPTION</option>
                    }
                </select>
            </div>
        </div>

        <div class="row g-5 mb-5">   
            <div class="col-md-2">Disease status:</div>
            <div class="col-md-2">
                <select id="ddlStatus" name="status" class="w-100">
                    <option value="" selected>select...</option>
                    @foreach (var d in Model.statusList)
                    {
                        <option value="@d.DISEASE_STATUS">@d.DISEASE_STATUS</option>
                    }
                </select>
            </div>
            <div class="col-md-2">Comments:</div>
            <div class="col-md-6"><input type="text" id="txtComments" name="comments" /></div>
        </div>

        <div id="metadata" hidden="true">
            <input class="w-100" name="mpi" value="@Html.DisplayFor(model => model.patient.MPI)" />
        </div>
    </form>

    <div class="row g-5 mb-5">
        <div class="col-md-2">
            <input type="button" class="btn btn-default btn-success" value="Save" id="btnSave" />
        </div>
    </div>
</div>


<script type="text/javascript">

    document.getElementById("btnSave").addEventListener("click", AddTest);
    document.getElementById("btnBack").addEventListener("click", GoBack);

    function GoBack() 
    {
        window.history.back();
        //window.close();
    }

    function AddTest() 
    {
        
        if (CheckFormValid() == 1) 
        {            
            document.getElementById("frmAddNew").submit();           
        }        
    }

    function CheckFormValid() 
    { //validation to ensure all required data is entered
       
        if (document.getElementById("ddlDiag").value == null || document.getElementById("ddlDiag").value == "") 
        {
            window.alert("Please select a diagnosis.");
            return 0;
        }

        if (document.getElementById("ddlStatus").value == null || document.getElementById("ddlStatus").value == "") 
        {
            window.alert("Please select a disease status.");
            return 0;
        }

        if (document.getElementById("txtComments").value.match(/};.*/)) {
            window.alert("Oi! Stop trying to inject SQL code into my form!");
            return 0;
        }        
        return 1;
    }

</script>
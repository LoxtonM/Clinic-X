@*@model IEnumerable<ClinicX.Models.Clinics>*@
@model ClinicX.ViewModels.ClinicVM
@{
    ViewData["Title"] = "Clinic-X - Clinics";
}

@*<div>
    <input type="button" value="Back" id="btnBack" class="btn btn-default btn-success" />
</div>*@

<div class="container">
    <div class="row g-5 mb-5">
        @*<h1 class="text-center">Welcome @Html.DisplayFor(model => model.FirstOrDefault().Clinician)!</h1>*@

        @*@if (Model.clinicsList.Count(x => x.BOOKED_DATE.Value.ToString("dd/MM/yyyy") == System.DateTime.Now.ToString("dd/MM/yyyy")) == 0)*@
        @if (Model.currentClinicsList.Count() == 0)
        {
            <h2 class="text-center">You have no clinics scheduled today.</h2>
        }
        else
        {
            <div class="row g-5 mb-5">
                <h2 class="text-center">In clinic today:</h2>       
        
                <table class="table">
                    <thead>
                        <tr>
                            <th></th>
                            <th>CGU No</th>
                            <th>Patient</th>
                            <th>Clinic</th>
                            @*<th>Booked Date</th>*@
                            <th>Booked Time</th>
                            <th>Indication Notes</th>
                            <th>Outcome</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var item in Model.currentClinicsList)
                        {
                            if (item.BOOKED_DATE.Value.ToString("dd/MM/yyyy") == System.DateTime.Now.ToString("dd/MM/yyyy"))
                            {                
                                <tr>
                                    <td><a asp-controller="Clinic" asp-action="ApptDetails" asp-route-id=@item.RefID class="btn btn-success">Select</a></td>
                                    <td>@item.CGU_No</td>
                                    <td>@item.FIRSTNAME @item.LASTNAME</td>
                                    <td>@item.Clinic</td>
                                    @*<td>@item.BOOKED_DATE.Value.ToString("dd/MM/yyyy")</td>*@                                    
                                    <td>@item.BOOKED_TIME.Value.ToString("HH:mm")</td>
                                    <td>@item.IndicationNotes</td>
                                    <td>@item.Attendance</td>
                                </tr>
                            }                               
                        }
                    </tbody>
                </table>
            </div>
        }
    </div>

    <div class="row g-5 mb-5">
        <hr />
    </div>


    <div class="row g-5 mb-5">
        @if (Model.futureClinicsList.Count() == 0)
        {
            @*<h2 class="text-center">You have no upcoming clinics.</h2>*@
        }
        else
        {
            @*<form id="frmFutureClinics">*@
                <div class="row g-5 mb-3">
                    <h2>Upcoming clinics</h2>
                </div>
                <div class="row g-5 mb-3">
                    <div class="col-2">
                        @*<label class="form-label" for="ddlFutureClinics">Upcoming Clinics:</label>*@
                    </div>
                    <div class="col-8">
                        @*<select class="form-select" name="ddlFutureClinics" id="ddlFutureClinics">
                            @foreach (var item in Model.futureClinicsList)
                            {
                                @if (item.BOOKED_DATE > System.DateTime.Now.AddDays(-1))
                                {
                                    <option value="@item.RefID">@item.CGU_No - @item.FIRSTNAME @item.LASTNAME, @item.Clinic, @item.BOOKED_DATE.Value.ToString("dd/MM/yyyy") - @item.BOOKED_TIME.Value.ToString("HH:mm")</option>
                                }
                            }
                        </select>*@
                        <table class="table">
                            <thead>
                                <tr>
                                    <th></th>
                                    <th>CGU No</th>
                                    <th>Patient</th>
                                    <th>Clinic</th>
                                    <th>Booked Date</th>
                                    <th>Booked Time</th>
                                    <th>Indication Notes</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var item in Model.futureClinicsList)
                                {
                                    <tr>
                                        <td><a asp-controller="Clinic" asp-action="ApptDetails" asp-route-id=@item.RefID class="btn btn-success">Select</a></td>
                                        <td>@item.CGU_No</td>
                                        <td>@item.FIRSTNAME @item.LASTNAME</td>
                                        <td>@item.Clinic</td>
                                        <td>@item.BOOKED_DATE.Value.ToString("dd/MM/yyyy")</td>
                                        <td>@item.BOOKED_TIME.Value.ToString("HH:mm")</td>
                                        <td>@item.IndicationNotes</td>
                                    </tr>                                
                                }
                            </tbody>
                        </table>

                    </div>            
                    <div class="col-2">
                        @*<input type="button" value="Select" id="btnSelectFutureClinic" class="btn btn-default btn-success" />*@
                    </div>
                    <div class="col-8"></div>
                </div>
            @*</form>*@
        }
    </div>
    <div class="row g-5 mb-5">
        <form id="frmPastClinics">
            <div class="row g-5 mb-3">
                <h2>Past clinics</h2>
            </div>
            <div class="row g-5 mb-3">
                <div class="col-md-2" style="text-align:right">
                    <label>From date:</label>
                </div>
                <div class="col-md-4">
                    <input type="date" name="dFilterDate" asp-for=@Model.dClinicFilterDate /> 
                </div>
                <div class="col-md-2">
                    <label>Only Show Outstanding:</label>
                </div>
                <div class="col-md-1">
                    <input type="checkbox" id="chkIsShowOutstanding" class="check" asp-for=@Model.isClinicOutstanding) onchange="SetShowOutstandingChecked()" />
                </div>
                <div class="col-md-1">
                    <input type="text" id="txtIsShowOutstanding" name="isShowOutstanding" asp-for=@Model.isClinicOutstanding hidden="true" />
                </div>
                <div class="col-md-2">
                    <button type="submit" class="btn btn-success">Update</button>
                </div>
            </div>
            <div class="row g-5 mb-3">                
                <div class="col-2">
                   @*<label class="form-label" for="ddlPastClinics">Past Clinics:</label>*@
                </div>
                <div class="col-8">
                    <select class="form-select" name="ddlPastClinics" id="ddlPastClinics">
                        @foreach (var item in Model.pastClinicsList)
                        {
                            @*if(item.BOOKED_DATE <= System.DateTime.Now.AddDays(-1))
                            {*@
                                <option value="@item.RefID">@item.CGU_No - @item.FIRSTNAME @item.LASTNAME, @item.Clinic, @item.BOOKED_DATE.Value.ToString("dd/MM/yyyy") - @item.BOOKED_TIME.Value.ToString("HH:mm") - @item.Attendance</option>
                            @*}*@
                        }
                    </select>
                </div>            
                <div class="col-2">
                    <input type="button" value="Select" id="btnSelectPastClinic" class="btn btn-default btn-success"  />
                </div>
                <div class="col-8"></div>
            </div>
        </form>    
    </div>
</div>

<script type="text/javascript">
    //document.getElementById("btnBack").addEventListener("click", GoBack);
    document.getElementById("btnSelectPastClinic").addEventListener("click", OpenPastClinic);
    //document.getElementById("btnSelectFutureClinic").addEventListener("click", OpenFutureClinic);
    
    function GoBack() 
    {
        window.history.back();
        //window.close();
    }

    function OpenPastClinic() 
    {
        let _Clinic = document.getElementById('ddlPastClinics')

        if (_Clinic.value == "" || _Clinic.value == null) {
            alert("You must choose a clinic.");
        }
        else 
        {
            let _url = ""
            _url = window.location.protocol + "//" + window.location.hostname + ":" + window.location.port + "/Clinic/ApptDetails?id=" + _Clinic.value;
            location.href = _url;
            //window.open(_url);
        }
    }

    function OpenFutureClinic() {
        let _Clinic = document.getElementById('ddlFutureClinics')

        if (_Clinic.value == "" || _Clinic.value == null) {
            alert("You must choose a clinic.");
        }
        else {
            let _url = ""
            _url = window.location.protocol + "//" + window.location.hostname + ":" + window.location.port + "/Clinic/ApptDetails?id=" + _Clinic.value;
            location.href = _url;
            //window.open(_url);
        }
    }

    function SetShowOutstandingChecked()
    {
        document.getElementById("txtIsShowOutstanding").value = document.getElementById("chkIsShowOutstanding").checked;
        }

</script>

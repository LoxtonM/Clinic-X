@model ClinicX.Models.Clinics
@{
    ViewData["Title"] = "Clinic-X - Appointment Details";
}

<div class="container">
    <div class="row mb-5 g-5">
        @*<input type="button" value="Back" id="btnBack" class="btn btn-default btn-success" />*@
        <div class="col-md-2">
            <a class="btn btn-default btn-success" asp-controller="Clinic" asp-action="Index">Back to Clinics Index</a>
        </div>
        <div class="col-md-1">
            <a class="btn btn-default btn-success" asp-controller="Patient" asp-action="PatientDetails" asp-route-id=@Html.ValueFor(model => model.MPI)>Patient Details</a>
        </div>    
        <div class="col-md-1">
            <a id="btnRecordOutcome" class="btn btn-default btn-success" asp-controller="Clinic" asp-action="Edit" asp-route-id=@Html.ValueFor(model => model.RefID)>Record Outcome</a>        
        </div>
        <div class="col-md-1">
            <a id="btnDiagnoses"  class="btn btn-default btn-success" asp-controller="Diagnosis" asp-action="Index" asp-route-id=@Html.ValueFor(model => model.MPI)>Record Diagnoses</a>
        </div>
        <div class="col-md-1">
            <a id="btnTests" class="btn btn-default btn-success" asp-controller="Test" asp-action="Index" asp-route-id=@Html.ValueFor(model => model.MPI)>Record Tests</a>        
        </div>
        <div class="col-md-1">
            <a id="btnClinicalNotes" class="btn btn-default btn-success" asp-controller="ClinicalNote" asp-action="Index" asp-route-id=@Html.ValueFor(model => model.MPI)>Clinical Notes</a>
        </div>
        <div class="col-md-1">
            <a id="btnDictatedLetter" class="btn btn-default btn-success" asp-controller="DictatedLetter" asp-action="Create" asp-route-id=@Html.ValueFor(model => model.RefID)>Dictate Letter</a>
        </div>
        <div class="col-md-1">
            <a id="btnReview" class="btn btn-default btn-success" asp-controller="Review" asp-action="Create" asp-route-id=@Html.ValueFor(model => model.RefID)>Schedule Review</a>
        </div>
    </div>

    <h1>Appointment Details</h1>

    <div>
        <dl class="row">
            <dt class="col-sm-2">
                @Html.DisplayNameFor(model => model.CGU_No):
            </dt>
            <dd class="col-sm-10">
                @Html.DisplayFor(model => model.CGU_No)
            </dd>
            <dt class="col-sm-2">
                Patient:
            </dt>
            <dd class="col-sm-10">            
                <a asp-controller="Patient" asp-action="PatientDetails" asp-route-id=@Html.ValueFor(model => model.MPI)>@Html.DisplayFor(model => model.FIRSTNAME) @Html.DisplayFor(model => model.LASTNAME)</a>
            </dd>
            <dt class="col-sm-2">
                @Html.DisplayNameFor(model => model.AppType):
            </dt>
            <dd class="col-sm-10">
                @Html.DisplayFor(model => model.AppType)
            </dd>
            <dt class="col-sm-2">
                @Html.DisplayNameFor(model => model.BOOKED_DATE):
            </dt>
            <dd class="col-sm-10">
                @Html.DisplayFor(model => model.BOOKED_DATE)
            </dd>
            <dt class="col-sm-2">
                @Html.DisplayNameFor(model => model.BOOKED_TIME):
            </dt>
            <dd class="col-sm-10">
                @Html.DisplayFor(model => model.BOOKED_TIME)
            </dd>
            <dt class="col-sm-2">
                @Html.DisplayNameFor(model => model.Clinic):
            </dt>
            <dd class="col-sm-10">
                @Html.DisplayFor(model => model.Clinic)
            </dd>
            @if (Model.Notes != null)
            {
                <dt class="col-sm-2">
                    @Html.DisplayNameFor(model => model.Notes):
                </dt>
                <dd class="col-sm-10">
                    @Html.DisplayFor(model => model.Notes)
                </dd>
            }
            @if (Model.BOOKED_DATE <= DateTime.Now)
            {
                @if (@Html.ValueFor(model => model.Attendance) != null && @Html.ValueFor(model => model.Attendance) != "")
                {
                    <dt class="col-sm-2">
                        @Html.DisplayNameFor(model => model.Attendance):
                    </dt>
                    <dd class="col-sm-10">
                        @if (@Html.ValueFor(model => model.Attendance) == "Attended")
                        {
                            <span>Seen by @Html.DisplayFor(model => model.SeenByClinician) on @Html.DisplayFor(model => model.BOOKED_DATE) at @Html.DisplayFor(model => model.ArrivalTime)</span>
                        }
                        else
                        {
                            @Html.DisplayFor(model => model.Attendance)
                        }                    
                    </dd>
                }
            }
        </dl>
    </div>
</div>

<script type="text/javascript">

    //document.getElementById("btnBack").addEventListener("click", GoBack);
    window.addEventListener("load", LoadClinic);
    
    function GoBack()
    {
        window.history.back();
        //window.close();
    }

    function LoadClinic() {
        //window.alert("hello");
        //this is really fucking stupid - apparently the date from SQL is not a date,
        //so javascript makes it American unless I do all this bullshit!!!
        //var clinicDate = new Date("@(Model.BOOKED_DATE)");        
        var bs = "@(Model.BOOKED_DATE)".split("/");        
        var clinicDate = new Date(bs[2].replace(" 00:00:00", "") + "-" + bs[1] + "-" + bs[0]);        
        var today = new Date();
        today.setHours(0, 0, 0, 0);
        //window.alert(clinicDate);
        //window.alert(today);
        //if ((clinicDate.getFullYear > today.getFullYear) || (clinicDate.getMonth > today.getMonth && clinicDate.getDate > today.getDate)) { 
        if (clinicDate > today) {           
            //since disabled refuses to work, for some stupid reason, I have to hide it instead
            //name of the gods, Javascript is by far the most bullshit programming language I have ever used!!!
            document.getElementById("btnRecordOutcome").hidden = true;
            document.getElementById("btnDiagnoses").hidden = true;
            document.getElementById("btnTests").hidden = true;
            document.getElementById("btnClinicalNotes").hidden = true;
            document.getElementById("btnDictatedLetter").hidden = true;
            document.getElementById("btnReview").hidden = true;
        }       

    }
        
    

</script>
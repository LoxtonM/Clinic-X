@model ClinicX.ViewModels.PatientVM
@{
    ViewData["Title"] = "Clinic-X - Patient Details";
}

<div class="container">
    <div class="row mb-5 g-5">
        <div class="col-md-2">
            @*<button type="button" value="Back" id="btnBack" class="btn btn-default btn-success">Back</button>*@
            <a type="button" class="btn btn-default btn-success" asp-controller="Home" asp-action="Index">Back to Home Page</a>
        </div>
        <div class="col-md-1">
            <a id="btnDiagnosis" class="btn btn-default btn-success" asp-controller="Diagnosis" asp-action="Index" asp-route-id=@Model.patient.MPI>Record Diagnoses</a>
        </div>
        <div class="col-md-1">
            <a id="btnDiagnosis" class="btn btn-default btn-success" asp-controller="Test" asp-action="Index" asp-route-id=@Model.patient.MPI>Record Tests</a>
        </div>
        <div class="col-md-1">
            <a id="btnDiagnosis" class="btn btn-default btn-success" asp-controller="ClinicalNote" asp-action="Index" asp-route-id=@Model.patient.MPI>Clinical Notes</a>
        </div>
        <div class="col-md-6"></div>
        <div class="col-md-1">
            <a id="btnEDMS" class="btn btn-default btn-success" href="" target="_blank">EDMS (GEMR)</a>
        </div>
    </div>

    @if (Model.patient.DCTM_Folder_ID == null)
    {
        <h3 class="text-center">Patient not yet made electronic - no EDMS record exists</h3>
    }

    <div class="row mb-5">
        <hr />
    </div>

    @if (Model.patientPathway != null)
    {        
        <div class="row mb-5 g-5">
            <div class="row fw-bold">
                <div class="col-md-2"></div>
                <div class="col-md-1">Referral Date</div>
                <div class="col-md-1">Pathway</div>
                <div class="col-md-1">Triaged</div>            
                <div class="col-md-1">Appt Booked</div>
                <div class="col-md-1">Seen in Clinic</div>                
                <div class="col-md-1">Letter Dictated</div>
                <div class="col-md-1">Letter Printed</div>
                <div class="col-md-1">Review Planned</div>            
                <div class="col-md-2">18 week Clock Status</div>
            </div>
            <div class="row"> @*Pathway Indicator - shows how far along patient is  *@
                <div class="col-md-2"><b>Oldest active ICP:</b></div>
                <div class="col-md-1">@Model.patientPathway.REFERRAL_DATE.ToString("dd/MM/yyyy")</div>
                <div class="col-md-1">@Model.patientPathway.PATHWAY</div>
            <div class="col-md-1">
                @if(@Model.patientPathway.Triaged == 1)
                {
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="green" class="bi bi-person-fill-check" viewBox="0 0 16 16">
                    <path d="M12.5 16a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7Zm1.679-4.493-1.335 2.226a.75.75 0 0 1-1.174.144l-.774-.773a.5.5 0 0 1 .708-.708l.547.548 1.17-1.951a.5.5 0 1 1 .858.514ZM11 5a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"/>
                    <path d="M2 13c0 1 1 1 1 1h5.256A4.493 4.493 0 0 1 8 12.5a4.49 4.49 0 0 1 1.544-3.393C9.077 9.038 8.564 9 8 9c-5 0-6 3-6 4Z"/>
                    </svg>
                    <svg xmlns="http://www.w3.org/2000/svg" width="52" height="20" fill="currentColor" class="bi bi-arrow-right" viewBox="0 0 16 16">
                    <path fill-rule="evenodd" d="M1 8a.5.5 0 0 1 .5-.5h11.793l-3.147-3.146a.5.5 0 0 1 .708-.708l4 4a.5.5 0 0 1 0 .708l-4 4a.5.5 0 0 1-.708-.708L13.293 8.5H1.5A.5.5 0 0 1 1 8z"/>
                    </svg>
                }        
                else
                {
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-person-fill-dash" viewBox="0 0 16 16">
                    <path d="M12.5 16a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7ZM11 12h3a.5.5 0 0 1 0 1h-3a.5.5 0 0 1 0-1Zm0-7a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"/>
                    <path d="M2 13c0 1 1 1 1 1h5.256A4.493 4.493 0 0 1 8 12.5a4.49 4.49 0 0 1 1.544-3.393C9.077 9.038 8.564 9 8 9c-5 0-6 3-6 4Z"/>
                    </svg>
                }
                </div>
                @if(Model.patientPathway.ToBeSeenByCons == 1 || Model.patientPathway.ToBeSeenByGC == 1 || Model.patientPathway.AppointmentBooked == 1)
                {
                    <div class="col-md-1">
                        @if(@Model.patientPathway.AppointmentBooked == 1)
                        {
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="green" class="bi bi-person-fill-check" viewBox="0 0 16 16">
                            <path d="M12.5 16a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7Zm1.679-4.493-1.335 2.226a.75.75 0 0 1-1.174.144l-.774-.773a.5.5 0 0 1 .708-.708l.547.548 1.17-1.951a.5.5 0 1 1 .858.514ZM11 5a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"/>
                            <path d="M2 13c0 1 1 1 1 1h5.256A4.493 4.493 0 0 1 8 12.5a4.49 4.49 0 0 1 1.544-3.393C9.077 9.038 8.564 9 8 9c-5 0-6 3-6 4Z"/>
                            </svg>
                            <svg xmlns="http://www.w3.org/2000/svg" width="52" height="20" fill="currentColor" class="bi bi-arrow-right" viewBox="0 0 16 16">
                            <path fill-rule="evenodd" d="M1 8a.5.5 0 0 1 .5-.5h11.793l-3.147-3.146a.5.5 0 0 1 .708-.708l4 4a.5.5 0 0 1 0 .708l-4 4a.5.5 0 0 1-.708-.708L13.293 8.5H1.5A.5.5 0 0 1 1 8z"/>
                            </svg>
                        }        
                        else
                        {
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-person-fill-dash" viewBox="0 0 16 16">
                            <path d="M12.5 16a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7ZM11 12h3a.5.5 0 0 1 0 1h-3a.5.5 0 0 1 0-1Zm0-7a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"/>
                            <path d="M2 13c0 1 1 1 1 1h5.256A4.493 4.493 0 0 1 8 12.5a4.49 4.49 0 0 1 1.544-3.393C9.077 9.038 8.564 9 8 9c-5 0-6 3-6 4Z"/>
                            </svg>
                        }
                    </div>
                
            
                    <div class="col-md-1">
                        @if(@Model.patientPathway.Seen == 1)
                        {
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="green" class="bi bi-person-fill-check" viewBox="0 0 16 16">
                            <path d="M12.5 16a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7Zm1.679-4.493-1.335 2.226a.75.75 0 0 1-1.174.144l-.774-.773a.5.5 0 0 1 .708-.708l.547.548 1.17-1.951a.5.5 0 1 1 .858.514ZM11 5a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"/>
                            <path d="M2 13c0 1 1 1 1 1h5.256A4.493 4.493 0 0 1 8 12.5a4.49 4.49 0 0 1 1.544-3.393C9.077 9.038 8.564 9 8 9c-5 0-6 3-6 4Z"/>
                            </svg>
                            <svg xmlns="http://www.w3.org/2000/svg" width="52" height="20" fill="currentColor" class="bi bi-arrow-right" viewBox="0 0 16 16">
                            <path fill-rule="evenodd" d="M1 8a.5.5 0 0 1 .5-.5h11.793l-3.147-3.146a.5.5 0 0 1 .708-.708l4 4a.5.5 0 0 1 0 .708l-4 4a.5.5 0 0 1-.708-.708L13.293 8.5H1.5A.5.5 0 0 1 1 8z"/>
                            </svg>
                        }        
                        else
                        {
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-person-fill-dash" viewBox="0 0 16 16">
                            <path d="M12.5 16a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7ZM11 12h3a.5.5 0 0 1 0 1h-3a.5.5 0 0 1 0-1Zm0-7a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"/>
                            <path d="M2 13c0 1 1 1 1 1h5.256A4.493 4.493 0 0 1 8 12.5a4.49 4.49 0 0 1 1.544-3.393C9.077 9.038 8.564 9 8 9c-5 0-6 3-6 4Z"/>
                            </svg>
                        }
                    </div>
                }
                else
                {
                    <div class="col-md-1">
                        No appt/ letter only
                    </div>
                    <div class="col-md-1">
                        <svg xmlns="http://www.w3.org/2000/svg" width="52" height="20" fill="currentColor" class="bi bi-arrow-right" viewBox="0 0 16 16">
                        <path fill-rule="evenodd" d="M1 8a.5.5 0 0 1 .5-.5h11.793l-3.147-3.146a.5.5 0 0 1 .708-.708l4 4a.5.5 0 0 1 0 .708l-4 4a.5.5 0 0 1-.708-.708L13.293 8.5H1.5A.5.5 0 0 1 1 8z" />
                        </svg>
                    </div>
                }
            
                <div class="col-md-1">
                   @if(@Model.patientPathway.LetterDictated == 1)
                    {
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="green" class="bi bi-person-fill-check" viewBox="0 0 16 16">
                        <path d="M12.5 16a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7Zm1.679-4.493-1.335 2.226a.75.75 0 0 1-1.174.144l-.774-.773a.5.5 0 0 1 .708-.708l.547.548 1.17-1.951a.5.5 0 1 1 .858.514ZM11 5a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"/>
                        <path d="M2 13c0 1 1 1 1 1h5.256A4.493 4.493 0 0 1 8 12.5a4.49 4.49 0 0 1 1.544-3.393C9.077 9.038 8.564 9 8 9c-5 0-6 3-6 4Z"/>
                        </svg>
                        <svg xmlns="http://www.w3.org/2000/svg" width="52" height="20" fill="currentColor" class="bi bi-arrow-right" viewBox="0 0 16 16">
                        <path fill-rule="evenodd" d="M1 8a.5.5 0 0 1 .5-.5h11.793l-3.147-3.146a.5.5 0 0 1 .708-.708l4 4a.5.5 0 0 1 0 .708l-4 4a.5.5 0 0 1-.708-.708L13.293 8.5H1.5A.5.5 0 0 1 1 8z"/>
                        </svg>
                    }        
                    else
                    {
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-person-fill-dash" viewBox="0 0 16 16">
                        <path d="M12.5 16a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7ZM11 12h3a.5.5 0 0 1 0 1h-3a.5.5 0 0 1 0-1Zm0-7a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"/>
                        <path d="M2 13c0 1 1 1 1 1h5.256A4.493 4.493 0 0 1 8 12.5a4.49 4.49 0 0 1 1.544-3.393C9.077 9.038 8.564 9 8 9c-5 0-6 3-6 4Z"/>
                        </svg>
                    }
                </div>

                <div class="col-md-1">
                   @if(@Model.patientPathway.LetterPrinted == 1)
                    {
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="green" class="bi bi-person-fill-check" viewBox="0 0 16 16">
                        <path d="M12.5 16a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7Zm1.679-4.493-1.335 2.226a.75.75 0 0 1-1.174.144l-.774-.773a.5.5 0 0 1 .708-.708l.547.548 1.17-1.951a.5.5 0 1 1 .858.514ZM11 5a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"/>
                        <path d="M2 13c0 1 1 1 1 1h5.256A4.493 4.493 0 0 1 8 12.5a4.49 4.49 0 0 1 1.544-3.393C9.077 9.038 8.564 9 8 9c-5 0-6 3-6 4Z"/>
                        </svg>
                        <svg xmlns="http://www.w3.org/2000/svg" width="52" height="20" fill="currentColor" class="bi bi-arrow-right" viewBox="0 0 16 16">
                        <path fill-rule="evenodd" d="M1 8a.5.5 0 0 1 .5-.5h11.793l-3.147-3.146a.5.5 0 0 1 .708-.708l4 4a.5.5 0 0 1 0 .708l-4 4a.5.5 0 0 1-.708-.708L13.293 8.5H1.5A.5.5 0 0 1 1 8z"/>
                        </svg>
                    }        
                    else
                    {
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-person-fill-dash" viewBox="0 0 16 16">
                        <path d="M12.5 16a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7ZM11 12h3a.5.5 0 0 1 0 1h-3a.5.5 0 0 1 0-1Zm0-7a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"/>
                        <path d="M2 13c0 1 1 1 1 1h5.256A4.493 4.493 0 0 1 8 12.5a4.49 4.49 0 0 1 1.544-3.393C9.077 9.038 8.564 9 8 9c-5 0-6 3-6 4Z"/>
                        </svg>
                    }
                </div>

                <div class="col-md-1">
                   @if(@Model.patientPathway.ReviewPlanned == 1)
                    {
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="green" class="bi bi-person-fill-check" viewBox="0 0 16 16">
                        <path d="M12.5 16a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7Zm1.679-4.493-1.335 2.226a.75.75 0 0 1-1.174.144l-.774-.773a.5.5 0 0 1 .708-.708l.547.548 1.17-1.951a.5.5 0 1 1 .858.514ZM11 5a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"/>
                        <path d="M2 13c0 1 1 1 1 1h5.256A4.493 4.493 0 0 1 8 12.5a4.49 4.49 0 0 1 1.544-3.393C9.077 9.038 8.564 9 8 9c-5 0-6 3-6 4Z"/>
                        </svg>
                        <svg xmlns="http://www.w3.org/2000/svg" width="52" height="20" fill="currentColor" class="bi bi-arrow-right" viewBox="0 0 16 16">
                        <path fill-rule="evenodd" d="M1 8a.5.5 0 0 1 .5-.5h11.793l-3.147-3.146a.5.5 0 0 1 .708-.708l4 4a.5.5 0 0 1 0 .708l-4 4a.5.5 0 0 1-.708-.708L13.293 8.5H1.5A.5.5 0 0 1 1 8z"/>
                        </svg>
                    }        
                    else
                    {
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-person-fill-dash" viewBox="0 0 16 16">
                        <path d="M12.5 16a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7ZM11 12h3a.5.5 0 0 1 0 1h-3a.5.5 0 0 1 0-1Zm0-7a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"/>
                        <path d="M2 13c0 1 1 1 1 1h5.256A4.493 4.493 0 0 1 8 12.5a4.49 4.49 0 0 1 1.544-3.393C9.077 9.038 8.564 9 8 9c-5 0-6 3-6 4Z"/>
                        </svg>
                    }
                </div>
                <div class="col-md-2">@Model.patientPathway.ClockStatus</div>        
            </div>
        </div>    
    }
    else
    {
        <h2 class="text-center">No active pathway exists</h2>
    }

    <div class="row mb-2">
        <hr />
    </div>

    @if (Model.alerts.Count > 0)
    {
        <h1 class="text-danger" class="text-center">There are active alerts for this patient</h1>
    }

    <div class="row mb-5 g-5">
        <button class="btn btn-default btn-success" data-bs-toggle="collapse" data-bs-target="#collapsePatientDetails" aria-expanded="true" aria-controls="collapseExample">Patient Details (click to expand/hide)</button>
    </div>



    <div class="collapse show" id="collapsePatientDetails">
        <h1>Patient Details for @Model.patient.FIRSTNAME @Model.patient.LASTNAME</h1>

        <dl class="row">
            @*Row 1 - CGU number, GP facility*@
            <dt class="col-sm-2">
                @Html.DisplayNameFor(model => model.patient.CGU_No):
            </dt>
            <dd class="col-sm-4">
                @Html.DisplayFor(model => model.patient.CGU_No)
            </dd>
            <dt class="col-sm-2">
                GP Details:
            </dt>
            <dd class="col-sm-4">
                @Html.DisplayFor(model => model.patient.GP_Facility)
            </dd>

            @*Row 2 - Preferred name (if any), GP*@
            @if(Model.patient.PtAKA != null)
            {
                <dt class="col-sm-2">
                    Preferred Name:
                </dt>
                <dd class="col-sm-4">            
                    @Html.DisplayFor(model => model.patient.PtAKA)
                </dd>
            }
            else
            {
                <dt class="col-sm-2"></dt><dd class="col-sm-4"></dd>
            }
            <dt class="col-sm-2"></dt>
            <dd class="col-sm-4">
                @Html.DisplayFor(model => model.patient.GP)
            </dd>
        
            @*Row 3 - DOB*@
            <dt class="col-sm-2">
                @Html.DisplayNameFor(model => model.patient.DOB):
            </dt>
            <dd class="col-sm-10">
                @if (Model.patient.DOB != null)
                {
                    @Html.DisplayFor(model => model.patient.DOB)
                }
                else
                {
                    <span>Not known</span>
                }
            </dd>

            @*Row 4 - NHS number, primary language*@
            <dt class="col-sm-2">
                @Html.DisplayNameFor(model => model.patient.SOCIAL_SECURITY):
            </dt>
            <dd class="col-sm-4">
                @Html.DisplayFor(model => model.patient.SOCIAL_SECURITY)
            </dd>
            <dt class="col-sm-2">
                Primary Language:
            </dt>
            <dd class="col-sm-4">
                @Html.DisplayFor(model => model.patient.PrimaryLanguage)            
            </dd>

            @*Row 5 - Ethnicity, interpreter requirements*@
            <dt class="col-sm-2">
                Ethnicity:
            </dt>        
            <dd class="col-sm-4">
                @Html.DisplayFor(model => model.patient.Ethnic)
            </dd>       
            <dt class="col-sm-2">
                Interpreter required:
            </dt>
            <dd class="col-sm-4">
                @Html.DisplayFor(model => model.patient.IsInterpreterReqd)
            </dd>    
        
            <dd class="col-sm-12"><hr /></dd>       
        
            @*Row 6 - address, contact details*@
            <dt class="col-sm-2">
                Address:
            </dt>
            <dd class="col-sm-4">
                @Html.DisplayFor(model => model.patient.ADDRESS1)
            </dd>
            <dt class="col-sm-2">
                Contact number:
            </dt>
            <dd class="col-sm-4">
                @Html.DisplayFor(model => model.patient.TEL)
            </dd>

            <dt class="col-sm-2">            
            </dt>
            <dd class="col-sm-4">
                @Html.DisplayFor(model => model.patient.ADDRESS2)
            </dd>
            <dt class="col-sm-2">
                Mobile:
            </dt>
            <dd class="col-sm-4">
                @Html.DisplayFor(model => model.patient.PtTelMobile)
            </dd>
            
            <dt class="col-sm-2">            
            </dt>
            <dd class="col-sm-10">
                @Html.DisplayFor(model => model.patient.ADDRESS3)
            </dd>
        
            <dt class="col-sm-2">
            </dt>
            <dd class="col-sm-10">
                @Html.DisplayFor(model => model.patient.ADDRESS4)
            </dd>
            
            <dt class="col-sm-2">
            </dt>
            <dd class="col-sm-4">
                @Html.DisplayFor(model => model.patient.POSTCODE)
            </dd>        
            <dt class="col-sm-2">
                Email Address:
            </dt>
            <dd class="col-sm-4">
                @*@Html.DisplayFor(model => model.patient.EmailAddress)*@            
                @if (Model.patient.EmailAddress != null)
                {
                    @if (Model.patient.EmailCommsConsent == "Yes")
                    {                    
                        @Html.DisplayFor(model => model.patient.EmailAddress)
                    }
                }
                else
                {
                    <p>Patient hasn't consented to contact by email</p>
                }
            </dd>
        </dl>

    </div>

    <div class="row mb-2">
        <hr />
    </div>

    @if (Model.alerts.Count > 0)
    {
        <div class="row mb-5 g-5">
            <button class="btn btn-default btn-success" data-bs-toggle="collapse" data-bs-target="#collapseAlertTable" aria-expanded="false" aria-controls="collapseExample">Alerts (click to expand/hide)</button>
        </div>
        <div class="collapse" id="collapseAlertTable">
            <h4>Active Alerts</h4>
            <div class="row">
                <table class="table">
                    <thead>
                        <tr class="fw-bold">
                            <td>Type</td>
                            <td>Protected Address</td>
                            <td>Effective From</td>                        
                            <td>Details</td>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var a in Model.alerts)
                        {
                            <tr>                            
                                <td>@a.AlertType</td>
                                @if (@a.ProtectedAddress)
                                {
                                    <td class="redtext"><strong>Yes</strong></td>
                                }
                                else
                                {
                                    <td>No</td>
                                }
                                <td>@a.EffectiveFromDate.ToString("dd/MM/yyyy")</td>
                                <td>@a.Comments</td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div> 
        </div>
    }

    <div class="row mb-5 g-5">
        <button class="btn btn-default btn-success" data-bs-toggle="collapse" data-bs-target="#collapseDiaryTable" aria-expanded="false" aria-controls="collapseExample">Diary (click to expand/hide)</button>
    </div>

    <div class="collapse" id="collapseDiaryTable">       
        @if (Model.diary.Count > 0)
        {
            <h4>Diary</h4>
            <div class="row">
                <table class="table">
                    <thead>
                        <tr class="fw-bold">
                            <td>Diary Date</td>
                            <td>Diary With</td>
                            <td>Action</td>
                            <td>Text</td>
                            <td>Doc Code</td>
                            <td>Related Ref ID</td>                        
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var d in Model.diary)
                        {
                            <tr>
                                <td>@d.DiaryDate.Value.ToString("dd/MM/yyyy")</td>
                                <td>@d.DiaryWith</td>
                                <td>@d.DiaryAction</td>
                                <td>@d.DiaryText</td>
                                <td>@d.DocCode</td>
                                <td>@d.RefID</td>
                            </tr>
                        }
                    </tbody>
                </table>    
            </div>
        }
        else
        {
            <h4>No diary entries.</h4>
        }
    </div>

    <div class="row mb-5 g-5">
        <button class="btn btn-default btn-success" data-bs-toggle="collapse" data-bs-target="#collapseRefTable" aria-expanded="false" aria-controls="collapseExample">Active Referrals (click to expand/hide)</button>
    </div>

    <div class="collapse" id="collapseRefTable">
        @if (Model.referrals.Count > 0)
        {
            <h4>Active Referrals</h4>
            <div class="row">
                <table class="table">
                    <thead>
                        <tr class="fw-bold">
                            <td>Referral Date</td>
                            <td>Type</td>
                            <td>Referring Clinician</td>
                            <td>Referring Facility</td>
                            <td>Indication</td>
                            <td>Pathway</td>
                            <td>Consultant</td>
                            <td>GC</td>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var r in Model.referrals)
                        {
                            <tr>
                                <td>@r.RefDate.Value.ToString("dd/MM/yyyy")</td>
                                <td>@r.RefType</td>
                                @if (@r.ReferringFacilityCode != "GP")
                                {
                                    <td>@r.ReferringClinician</td>
                                    <td>@r.ReferringFacility</td>
                                }
                                else
                                {
                                    <td>@Model.patient.GP</td>
                                    <td>@Model.patient.GP_Facility</td>
                                }
                                <td>@r.INDICATION</td>
                                <td>@r.PATHWAY</td>
                                <td>@r.LeadClinician</td>
                                <td>@r.GC</td>
                            </tr>
                        }
                    </tbody>
                </table>            
            </div>
        }
        else
        {
            <h4>No active referrals.</h4>
        }    
    </div>

    <div class="row mb-5 g-5">
        <button class="btn btn-default btn-success" data-bs-toggle="collapse" data-bs-target="#collapseHPOTable" aria-expanded="false" aria-controls="collapseExample">HPO Terms (click to expand/hide)</button>
    </div>

    <div class="collapse" id="collapseHPOTable">
        @if (Model.hpoTermDetails.Count > 0)
        {
            <h4>HPO Terms</h4>
            <div class="row">       
                @foreach (var t in Model.hpoTermDetails)
                {
                    <dt class="col-sm-2">
                        @t.TermCode
                    </dt>        
                    <dd class="col-sm-10">
                        @t.Term
                    </dd>
                }
            </div>
        }
        else
        {
            <h4>No HPO codes have been added. You can add HPO codes from a clinical note.</h4>
        }    
    </div>

    <div class="row mb-5 g-5">
        <button class="btn btn-default btn-success" data-bs-toggle="collapse" data-bs-target="#collapseRelativesTable" aria-expanded="false" aria-controls="collapseExample">Relatives (click to expand/hide)</button>
    </div>

    <div class="collapse" id="collapseRelativesTable">
        @if (Model.relatives.Count > 0)
        {
            <h4>Relatives</h4>
            <table class="table">
                <thead>
                    <tr class="fw-bold">
                        <th></th>
                        <th>Name</th>
                        <th>DOB</th>
                        <th>Alive</th>
                        <th>Diagnosis</th>
                        <th>Status</th>
                        <th>Site</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var item in Model.relatives)
                    {
                        <tr>                    
                            <td><a asp-controller="Relative" asp-action="RelativeDetails" asp-route-id=@item.relsid>Details</a></td>
                            <td>@item.Name</td>
                            @if (@item.DOB.HasValue)
                            {
                                <td>@item.DOB.Value.ToString("dd/MM/yyyy")</td>
                            }
                            else
                            {
                                <td>Not known</td>
                            }
                            <td>@item.RelAlive</td>
                            <td>@item.Diagnosis</td>
                            <td>@item.Status</td>
                            <td>@item.SiteCode</td>
                        </tr>
                    }
                </tbody>
            </table>
        }
        else
        {
            <h4>No relatives have been added.</h4>
        }

        <div class="row mb-5 g-5">
            <div class="col-md-2">
                <a type="button" asp-controller="Relative" asp-action="AddNew" asp-route-WMFACSID=@Model.patient.WMFACSID id="btnAddNew" class="btn btn-default btn-success">Add New Relative</a>
            </div>
        </div>
    </div>
</div>


<script type="text/javascript">

    //document.getElementById("btnBack").addEventListener("click", GoBack);
    window.addEventListener("load", LoadEDMSLink);

    function LoadEDMSLink() 
    {
        //only load EDMS link if there actually is one
        if ("@(Model.patient.DCTM_Folder_ID)" != "") {            
            document.getElementById("btnEDMS").href = "http://cg-live-164/Clinical_Genetics/#cg_pedigree_folder/folders%2Fcg_pedigree_folder%2F" + "@(Model.patient.DCTM_Folder_ID)" + "/cg_view_pedigree_patie";
        }
        else{
            document.getElementById("btnEDMS").hidden = true;            
        }
    }

    function GoBack() 
    {
        window.history.back();
        //window.close();
    }
    
</script>
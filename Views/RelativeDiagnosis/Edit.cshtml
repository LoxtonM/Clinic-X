@model ClinicX.ViewModels.RelativeDiagnosisVM
@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@{
}

<div class="container">    
    <div class="row g-5 mb-5">
        <div class="col-md-2">
            @*<input type="button" value="Back" id="btnBack" class="btn btn-default btn-success" />*@
            @*<a type="button" class="btn btn-default btn-success" asp-controller="Diagnosis" asp-action="Index" asp-route-id=@Html.ValueFor(Model => Model.patient.MPI)>Back to Diagnosis List</a>*@
        </div>
    </div>

    <div class="row g-5 mb-5">
        <h1>Add new diagnosis</h1>
    </div>
    <div class="row g-5 mb-5">
        <form id="frmAddNew" asp-action="Edit">
            <div class="row g-5 mb-5">
                <h2>Diagnosis Details:</h2>
            </div>
            <div class="row g-5 mb-5">
                <div class="col-md-1">
                    <label>Reported Diagnosis:</label>
                </div>
                <div class="col-md-3">
                    @Html.DisplayFor(model => model.relativesDiagnosis.Diagnosis)
                </div>
                <div class="col-md-1">
                    <label>Age:</label>
                </div>
                <div class="col-md-2">
                    @Html.DisplayFor(model => model.relativesDiagnosis.AgeDiag)
                </div>
                <div class="col-md-1">
                    <label>Hospital(s):</label>
                </div>
                <div class="col-md-4">
                    @Html.DisplayFor(model => model.relativesDiagnosis.Hospital)
                </div>
            </div>

            <div class="row g-5 mb-5">
                <h2>Information Request:</h2>
            </div>
            <div class="row g-5 mb-5">
                <div class="col-md-1">
                    <label>Source:</label>
                </div>
                <div class="col-md-2">
                    @Html.DisplayFor(model => model.relativesDiagnosis.CRegCode)
                </div>
                <div class="col-md-1">
                    <label>
                        Date Requested:
                    </label>
                </div>
                <div class="col-md-2">
                    @Html.DisplayFor(model => model.relativesDiagnosis.DateReq)
                </div>
                <div class="col-md-1">
                    <label>Consultant:</label>
                </div>
                <div class="col-md-2">
                    @Html.DisplayFor(model => model.relativesDiagnosis.Cons)
                </div>
            </div>
            <div class="row mb-5 g-5">
                <div class="col-md-4" style="text-align:right">
                    <label>Information Not Requested:</label>                
                </div>
                <div class="col-md-8">
                    @Html.DisplayFor(model => model.relativesDiagnosis.Status)
                </div>
            </div>
            <div class="row g-5 mb-5">
                <div class="col-md-1">
                    <label>Consent Provided:</label>
                </div>
                <div class="col-md-2">
                    <select id="ddlStatus" name="sConsent" asp-for=@Model.relativesDiagnosis.Consent>
                        <option value="">select...</option>
                        <option value="Y">Yes</option>
                        <option value="N">No</option>
                        <option value="N/A">Not Applicable</option>
                    </select>
                </div>
                <div class="col-md-1">
                    <label>Date Received:</label>
                </div>
                <div class="col-md-2">
                    <input type="date" name="dDateReceived" asp-for=@Model.relativesDiagnosis.DateRec />
                </div>
                <div class="col-md-1">
                    <label>Requested By:</label>
                </div>
                <div class="col-md-2">
                    @Html.DisplayFor(model => model.relativesDiagnosis.ReqBy)
                </div>
            </div>
            <div class="row g-5 mb-5">
                <h2>Request Outcome:</h2>
            </div>
            <div class="row g-5 mb-5">
                <div class="col-md-1">
                    <label>Confirmed:</label>
                </div>
                <div class="col-md-2">
                    <select id="ddlStatus" name="sConfirmed">                        
                        <option value="Y">Yes</option>
                        <option value="N">No</option>
                        <option value="X">Unknown</option>
                    </select>
                </div>
                <div class="col-md-2">
                    <label>Date of Diagnosis:</label>
                </div>
                <div class="col-md-2">
                    <input type="date" name="dConfDiagDate" />
                </div>
                <div class="col-md-2">
                    <label>Age at Diagnosis:</label>
                </div>
                <div class="col-md-1">
                    <input type="text" name="sConfDiagAge" />
                </div>
            </div>
            <div class="row g-5 mb-5">
                <div class="col-md-2">
                    <label>Site (topography)</label>
                </div>
                <div class="col-md-2">
                    <select name="sSiteCode">
                        <option value="">select...</option>
                    </select>
                </div>
                <div class="col-md-2">
                    <label>Laterality (side)</label>
                </div>
                <div class="col-md-2">
                    <select name="sLatCode">
                        <option value="">select...</option>
                    </select>
                </div>
                <div class="col-md-1">
                    <label>Grade/stage:</label>
                </div>
                <div class="col-md-1">
                    <select name="sGrade">
                        <option value="">select...</option>
                    </select>
                </div>
                <div class="col-md-1">
                    <label>Duke's:</label>
                </div>
                <div class="col-md-1">
                    <select name="sDukes">
                        <option value="">select...</option>
                    </select>
                </div>
            </div>
            <div class="row g-5 mb-5">
                <div class="col-md-2">
                    <label>Histology (morphology)</label>
                </div>
                <div class="col-md-2">
                    <select name="sMorphCode">
                        <option value="">select...</option>
                    </select>
                </div>
                <div class="col-md-2">
                    <label>Histology number:</label>
                </div>
                <div class="col-md-2">
                    <input type="text" name="sHistologyNumber" />
                </div>
                <div class="col-md-2">
                    <label>Comments:</label>
                </div>
                <div class="col-md-2">
                    <input type="text" name="sNotes" />
                </div>
            </div>




            <div id="metadata" hidden="true">
                <input name="iTumourID" asp-for=@Model.relativesDiagnosis.TumourID />
            </div>
        </form>

        <div class="row g-5 mb-5">
            <div class="col-md-2">
                <input type="button" class="btn btn-default btn-success" value="Save" id="btnSave" />
            </div>
        </div>
    </div>
</div>


    <script type="text/javascript">

        document.getElementById("btnSave").addEventListener("click", DoSubmit);
        document.getElementById("btnBack").addEventListener("click", GoBack);

        function GoBack() {
            window.history.back();
            //window.close();
        }

        function DoSubmit() 
        {

            //if (CheckFormValid() == 1) {
                document.getElementById("frmAddNew").submit();
            //}
        }

        function CheckFormValid() { //validation to ensure all required data is entered

            if (document.getElementById("ddlDiag").value == null || document.getElementById("ddlDiag").value == "") {
                window.alert("Please select a diagnosis.");
                return 0;
            }

            if (document.getElementById("ddlStatus").value == null || document.getElementById("ddlStatus").value == "") {
                window.alert("Please select a disease status.");
                return 0;
            }

            if (document.getElementById("txtComments").value.match(/};.*/)) {
                window.alert("Oi! Stop trying to inject SQL code into my form!");
                return 0;
            }
            return 1;
        }

    </script>